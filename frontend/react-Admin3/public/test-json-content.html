<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Content T&C Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .success { 
            color: #28a745; 
            background-color: #d4edda;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #c3e6cb;
        }
        .error { 
            color: #dc3545; 
            background-color: #f8d7da;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #f5c6cb;
        }
        .test-section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #ddd; 
            border-radius: 4px;
            background-color: #fafafa;
        }
        button { 
            margin: 5px; 
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        pre { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 4px; 
            overflow-x: auto;
            border: 1px solid #e9ecef;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .content-preview {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            background: white;
        }
        h3 {
            color: #343a40;
            margin-top: 0;
        }
        .json-structure {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>JSON Content T&C Implementation Test</h1>
        
        <div class="test-section">
            <h2>1. T&C API Test - JSON Format</h2>
            <p>Test the new JSON-based T&C content rendering system:</p>
            
            <button onclick="testJsonTermsEvaluation()">Test JSON T&C Evaluation API</button>
            <div id="json-evaluation-result"></div>
        </div>
        
        <div class="test-section">
            <h2>2. Content Format Comparison</h2>
            <p>Compare the old HTML format with new JSON format:</p>
            
            <button onclick="compareContentFormats()">Compare Content Formats</button>
            <div id="format-comparison"></div>
        </div>
        
        <div class="test-section">
            <h2>3. Implementation Benefits</h2>
            <div>
                <h4>‚úÖ JSON Content Benefits:</h4>
                <ul>
                    <li><strong>Structured Data:</strong> JSON provides structured content instead of HTML strings</li>
                    <li><strong>Material UI Integration:</strong> Direct mapping to React components</li>
                    <li><strong>Markdown Support:</strong> Built-in support for **bold text** and [links](url)</li>
                    <li><strong>Type Safety:</strong> Better validation and error handling</li>
                    <li><strong>Maintainability:</strong> Easier to update and customize content</li>
                    <li><strong>Internationalization:</strong> Better support for multi-language content</li>
                    <li><strong>Consistency:</strong> Uniform styling across all T&C messages</li>
                </ul>
                
                <h4>üîß Technical Features:</h4>
                <ul>
                    <li>Recursive variable processing in JSON structures</li>
                    <li>Backward compatibility with existing HTML content</li>
                    <li>Enhanced Django admin interface with separate fieldsets</li>
                    <li>React JsonContentRenderer component with Material UI mapping</li>
                    <li>Support for nested content structures (containers, lists, paragraphs)</li>
                </ul>
            </div>
        </div>

        <div class="test-section">
            <h2>4. Sample JSON Structure</h2>
            <pre id="sample-json" class="json-structure">{
    "message_container": {
        "element": "container",
        "text_align": "left",
        "class": "terms-conditions-content",
        "title": "h4",
        "text": "Terms & Conditions"
    },
    "content": [
        {
            "seq": 1,
            "element": "p",
            "text": "By completing this purchase, you agree to our Terms & Conditions..."
        },
        {
            "seq": 2,
            "element": "ul",
            "text": [
                "Product delivery terms and conditions",
                "Refund and cancellation policy",
                "Academic integrity requirements",
                "Data protection and privacy policy"
            ]
        },
        {
            "seq": 3,
            "element": "p",
            "text": "You can view our full [/terms-and-conditions](Terms & Conditions) and [/privacy-policy](Privacy Policy)."
        },
        {
            "seq": 4,
            "element": "p",
            "text": "**This acceptance is required to complete your order.**"
        }
    ]
}</pre>
        </div>
    </div>

    <script>
        const API_BASE = 'http://127.0.0.1:8888';
        
        async function apiCall(endpoint, options = {}) {
            try {
                const response = await fetch(API_BASE + endpoint, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                const data = await response.json();
                return { success: response.ok, data };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }
        
        function displayResult(elementId, result) {
            const element = document.getElementById(elementId);
            if (result.success) {
                element.innerHTML = `<div class="success">‚úÖ Success</div><pre>${JSON.stringify(result.data, null, 2)}</pre>`;
            } else {
                element.innerHTML = `<div class="error">‚ùå Error: ${result.error}</div><pre>${JSON.stringify(result, null, 2)}</pre>`;
            }
        }
        
        async function testJsonTermsEvaluation() {
            const result = await apiCall('/api/rules/engine/evaluate/', {
                method: 'POST',
                body: JSON.stringify({
                    entry_point_code: 'checkout_terms'
                })
            });
            
            // Enhanced display with JSON content highlighting
            const element = document.getElementById('json-evaluation-result');
            if (result.success && result.data.messages) {
                let output = '<div class="success">‚úÖ JSON T&C Content Retrieved Successfully</div>';
                
                result.data.messages.forEach((message, index) => {
                    output += `<div class="content-preview">
                        <h4>Message ${index + 1}: ${message.title || 'Terms & Conditions'}</h4>
                        <p><strong>Content Format:</strong> ${message.content_format || 'html'}</p>
                        
                        ${message.content_format === 'json' && message.json_content ? 
                            `<div>
                                <strong>JSON Content Structure:</strong>
                                <pre class="json-structure">${JSON.stringify(message.json_content, null, 2)}</pre>
                                <p><em>This JSON content will be rendered as Material UI components in the React frontend.</em></p>
                            </div>` :
                            `<div>
                                <strong>HTML Content:</strong>
                                <pre>${message.content || message.message}</pre>
                            </div>`
                        }
                    </div>`;
                });
                
                element.innerHTML = output;
            } else {
                displayResult('json-evaluation-result', result);
            }
        }
        
        async function compareContentFormats() {
            const result = await apiCall('/api/rules/engine/evaluate/', {
                method: 'POST',
                body: JSON.stringify({
                    entry_point_code: 'checkout_terms'
                })
            });
            
            const element = document.getElementById('format-comparison');
            if (result.success && result.data.messages) {
                const message = result.data.messages[0];
                
                let comparisonHtml = '<div class="comparison">';
                
                // JSON Format
                comparisonHtml += `
                    <div class="content-preview">
                        <h3>üÜï New JSON Format</h3>
                        <p><strong>Content Format:</strong> ${message.content_format}</p>
                        <p><strong>Benefits:</strong></p>
                        <ul>
                            <li>Structured data with element types</li>
                            <li>Direct Material UI component mapping</li>
                            <li>Built-in markdown parsing</li>
                            <li>Type safety and validation</li>
                            <li>Easier internationalization</li>
                        </ul>
                        ${message.json_content ? 
                            `<pre class="json-structure">${JSON.stringify(message.json_content, null, 2)}</pre>` :
                            '<p>No JSON content available</p>'
                        }
                    </div>
                `;
                
                // HTML Format (legacy)
                comparisonHtml += `
                    <div class="content-preview">
                        <h3>üìú Legacy HTML Format</h3>
                        <p><strong>Content Format:</strong> HTML</p>
                        <p><strong>Limitations:</strong></p>
                        <ul>
                            <li>Raw HTML strings</li>
                            <li>Security concerns (XSS)</li>
                            <li>Harder to maintain consistency</li>
                            <li>Limited styling control</li>
                            <li>No structured validation</li>
                        </ul>
                        <pre>${message.content || 'No HTML content available'}</pre>
                    </div>
                `;
                
                comparisonHtml += '</div>';
                element.innerHTML = comparisonHtml;
            } else {
                displayResult('format-comparison', result);
            }
        }
        
        // Auto-run test on page load
        window.onload = function() {
            console.log('Testing JSON T&C implementation...');
            testJsonTermsEvaluation();
        };
    </script>
</body>
</html>