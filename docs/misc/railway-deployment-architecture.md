# Railway Deployment Architecture for Admin3

## Executive Summary

This document outlines the comprehensive deployment architecture for deploying the Admin3 Django + React application to Railway for demo/UAT purposes. The deployment uses Railway's managed PostgreSQL database, Django backend, and React frontend services with minimal traffic optimization.

---

## 1. Architecture Overview

### 1.1 High-Level Architecture

```
┌─────────────────────────────────────────────────────────┐
│                    Railway Project                       │
│                      "Admin3-UAT"                        │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ┌────────────────┐  ┌────────────────┐  ┌───────────┐ │
│  │   PostgreSQL   │  │ Django Backend │  │  React    │ │
│  │   Database     │◄─┤   Service      │◄─┤ Frontend  │ │
│  │                │  │                │  │  Service  │ │
│  │  Port: 5432    │  │  Port: 8888    │  │ Port: 80  │ │
│  └────────────────┘  └────────────────┘  └───────────┘ │
│         │                    │                  │       │
│         └────────────────────┴──────────────────┘       │
│              Shared Environment Variables               │
└─────────────────────────────────────────────────────────┘
                            │
                            ▼
                  ┌──────────────────┐
                  │  Railway Domains │
                  ├──────────────────┤
                  │ backend.railway  │
                  │ frontend.railway │
                  └──────────────────┘
```

### 1.2 Service Components

| Service | Type | Purpose | Resources (Minimal Traffic) |
|---------|------|---------|------------------------------|
| **PostgreSQL** | Database | Managed PostgreSQL 14+ | Starter Plan (512MB RAM, 1GB Storage) |
| **Django Backend** | Web Service | REST API + Admin | Starter Plan (512MB RAM, 0.5 vCPU) |
| **React Frontend** | Static Site | User Interface | Starter Plan (512MB RAM, 0.5 vCPU) |

---

## 2. Git Branching Strategy for Demo/UAT

### 2.1 Recommended Branch Structure

```
main (production-ready, protected)
  │
  ├── develop (integration branch, protected)
  │     │
  │     ├── feature/* (feature development)
  │     ├── bugfix/* (bug fixes)
  │     └── hotfix/* (urgent fixes)
  │
  └── uat (Railway deployment branch, auto-deploy)
        │
        └── Triggers automatic Railway deployment
```

### 2.2 Branch Definitions

#### Main Branch (`main`)
- **Purpose**: Production-ready code
- **Protection**: Protected, requires PR reviews
- **Deployment**: Manual deployment only
- **Merges from**: `uat` after successful UAT validation

#### UAT Branch (`uat`)
- **Purpose**: Demo/UAT environment testing
- **Protection**: Semi-protected (admins can push directly)
- **Deployment**: **Auto-deploys to Railway on every push**
- **Merges from**: `develop` when ready for UAT testing
- **Railway Environment**: `uat` environment

#### Develop Branch (`develop`)
- **Purpose**: Integration of completed features
- **Protection**: Protected, requires PR reviews
- **Deployment**: None (local/dev only)
- **Merges from**: `feature/*`, `bugfix/*` branches

### 2.3 Workflow Example

```bash
# 1. Create UAT branch from current state
git checkout -b uat

# 2. Push to remote
git push -u origin uat

# 3. Configure Railway to deploy from 'uat' branch
# (Done via Railway CLI or Dashboard)

# 4. Future workflow: Promote develop to UAT
git checkout uat
git merge develop --no-ff
git push origin uat  # Triggers Railway auto-deploy

# 5. After UAT approval: Promote to main
git checkout main
git merge uat --no-ff
git push origin main
```

---

## 3. Railway Project Structure

### 3.1 Environment Setup

Railway supports multiple environments within a single project. For Admin3:

| Environment | Purpose | Auto-Deploy | Branch |
|-------------|---------|-------------|--------|
| **uat** | Demo/UAT Testing | Yes | `uat` |
| **production** | Future production (optional) | No | `main` |

### 3.2 Services Configuration

#### Service 1: PostgreSQL Database
```yaml
Service Name: admin3-postgres
Type: PostgreSQL 14+
Environment: uat
Resources:
  RAM: 512MB (Starter)
  Storage: 1GB
  CPU: Shared
Persistence: Yes (Managed by Railway)
Backup: Automated daily snapshots
```

**Environment Variables (Auto-generated by Railway):**
- `DATABASE_URL` - Full connection string
- `PGHOST` - Database host
- `PGPORT` - Database port (5432)
- `PGUSER` - Database user
- `PGPASSWORD` - Database password
- `PGDATABASE` - Database name

#### Service 2: Django Backend
```yaml
Service Name: admin3-backend
Type: Web Service
Root Directory: backend/django_Admin3
Build Command: pip install -r requirements.txt
Start Command: gunicorn django_Admin3.wsgi:application --bind 0.0.0.0:$PORT --workers 2 --timeout 60
Port: $PORT (Railway auto-assigns)
Environment: uat
Resources:
  RAM: 512MB (Starter)
  CPU: 0.5 vCPU
  Disk: Ephemeral (10GB)
Health Check:
  Path: /api/health/
  Timeout: 100s
Auto-Deploy: Yes (on uat branch push)
```

**Environment Variables (Manual Configuration):**
```env
# Django Settings
DJANGO_SETTINGS_MODULE=django_Admin3.settings.uat
DJANGO_ENV=uat
DJANGO_SECRET_KEY=${RANDOM_SECRET_KEY}
DEBUG=False
ALLOWED_HOSTS=${RAILWAY_PUBLIC_DOMAIN},${RAILWAY_PRIVATE_DOMAIN}

# Database (Reference PostgreSQL service)
DATABASE_URL=${admin3-postgres.DATABASE_URL}
DB_NAME=${admin3-postgres.PGDATABASE}
DB_USER=${admin3-postgres.PGUSER}
DB_PASSWORD=${admin3-postgres.PGPASSWORD}
DB_HOST=${admin3-postgres.PGHOST}
DB_PORT=${admin3-postgres.PGPORT}

# CORS & CSRF
FRONTEND_URL=https://${admin3-frontend.RAILWAY_PUBLIC_DOMAIN}
BACKEND_URL=https://${RAILWAY_PUBLIC_DOMAIN}
CORS_ALLOWED_ORIGINS=https://${admin3-frontend.RAILWAY_PUBLIC_DOMAIN}
CSRF_TRUSTED_ORIGINS=https://${RAILWAY_PUBLIC_DOMAIN},https://${admin3-frontend.RAILWAY_PUBLIC_DOMAIN}

# External APIs (from existing .env)
ADMINISTRATE_INSTANCE_URL=${ADMINISTRATE_INSTANCE_URL}
ADMINISTRATE_API_URL=${ADMINISTRATE_API_URL}
ADMINISTRATE_API_KEY=${ADMINISTRATE_API_KEY}
ADMINISTRATE_API_SECRET=${ADMINISTRATE_API_SECRET}
GETADDRESS_API_KEY=${GETADDRESS_API_KEY}

# Email Settings
EMAIL_HOST_USER=${EMAIL_HOST_USER}
EMAIL_HOST_PASSWORD=${EMAIL_HOST_PASSWORD}
DEFAULT_FROM_EMAIL=noreply@admin3-uat.railway.app

# Security Settings
SESSION_COOKIE_SECURE=True
CSRF_COOKIE_SECURE=True
SECURE_SSL_REDIRECT=True
SECURE_PROXY_SSL_HEADER=HTTP_X_FORWARDED_PROTO,https

# Static Files
STATIC_ROOT=/app/staticfiles
```

#### Service 3: React Frontend
```yaml
Service Name: admin3-frontend
Type: Web Service (Static)
Root Directory: frontend/react-Admin3
Build Command: npm install && npm run build
Start Command: npx serve -s build -l $PORT
Port: $PORT (Railway auto-assigns)
Environment: uat
Resources:
  RAM: 512MB (Starter)
  CPU: 0.5 vCPU
  Disk: Ephemeral (10GB)
Health Check:
  Path: /
  Timeout: 30s
Auto-Deploy: Yes (on uat branch push)
```

**Environment Variables:**
```env
# React Environment
NODE_ENV=production
REACT_APP_API_URL=https://${admin3-backend.RAILWAY_PUBLIC_DOMAIN}
REACT_APP_BACKEND_URL=https://${admin3-backend.RAILWAY_PUBLIC_DOMAIN}
REACT_APP_ENVIRONMENT=uat
GENERATE_SOURCEMAP=false

# Build Optimization
CI=false
```

---

## 4. Deployment Configuration Files

### 4.1 Backend Configuration

Create `backend/django_Admin3/railway.json`:

```json
{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS",
    "buildCommand": "pip install -r requirements.txt && python manage.py collectstatic --noinput"
  },
  "deploy": {
    "startCommand": "gunicorn django_Admin3.wsgi:application --bind 0.0.0.0:$PORT --workers 2 --timeout 60 --log-level info",
    "healthcheckPath": "/api/health/",
    "healthcheckTimeout": 100,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 3
  }
}
```

Create `backend/django_Admin3/Procfile`:

```
web: gunicorn django_Admin3.wsgi:application --bind 0.0.0.0:$PORT --workers 2 --timeout 60
release: python manage.py migrate --noinput
```

Create `backend/django_Admin3/runtime.txt`:

```
python-3.11
```

### 4.2 Frontend Configuration

Create `frontend/react-Admin3/railway.json`:

```json
{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS",
    "buildCommand": "npm install && npm run build"
  },
  "deploy": {
    "startCommand": "npx serve -s build -l $PORT",
    "healthcheckPath": "/",
    "healthcheckTimeout": 30,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 3
  }
}
```

Create `frontend/react-Admin3/.env.production`:

```env
REACT_APP_API_URL=$REACT_APP_BACKEND_URL
REACT_APP_ENVIRONMENT=uat
GENERATE_SOURCEMAP=false
```

### 4.3 Django UAT Settings

Create/Update `backend/django_Admin3/django_Admin3/settings/uat.py`:

```python
# uat.py
from .base import *
import dj_database_url

DEBUG = False
SECRET_KEY = env('DJANGO_SECRET_KEY')

# Security Settings for Railway
SECURE_SSL_REDIRECT = True
SECURE_PROXY_SSL_HEADER = ('HTTP_X_FORWARDED_PROTO', 'https')
SESSION_COOKIE_SECURE = True
CSRF_COOKIE_SECURE = True
SECURE_HSTS_SECONDS = 31536000
SECURE_HSTS_INCLUDE_SUBDOMAINS = True
SECURE_HSTS_PRELOAD = True

# Railway provides DATABASE_URL
DATABASES = {
    'default': dj_database_url.config(
        default=os.environ.get('DATABASE_URL'),
        conn_max_age=600,
        ssl_require=True
    )
}

# CORS Configuration
CORS_ALLOWED_ORIGINS = env.list('CORS_ALLOWED_ORIGINS')
CSRF_TRUSTED_ORIGINS = env.list('CSRF_TRUSTED_ORIGINS')

# Static Files for Railway
STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')
STATIC_URL = '/static/'

# External API Settings
ADMINISTRATE_INSTANCE_URL = env('ADMINISTRATE_INSTANCE_URL')
ADMINISTRATE_API_URL = env('ADMINISTRATE_API_URL')
ADMINISTRATE_API_KEY = env('ADMINISTRATE_API_KEY')
ADMINISTRATE_API_SECRET = env('ADMINISTRATE_API_SECRET')

# Disable email override in UAT
DEV_EMAIL_OVERRIDE = False

# Logging
LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'handlers': {
        'console': {
            'class': 'logging.StreamHandler',
        },
    },
    'root': {
        'handlers': ['console'],
        'level': 'INFO',
    },
}
```

---

## 5. Step-by-Step Deployment Process

### 5.1 Prerequisites

```bash
# 1. Verify Railway CLI is installed and authenticated
railway --version
railway whoami

# 2. Verify Railway token exists in .env
cat .env | grep RAILWAY_TOKEN
# Expected: RAILWAY_TOKEN=fd9a397a-1278-4ae7-81a1-cd4eef5ce968
```

### 5.2 Initial Project Setup

```bash
# Navigate to project root
cd C:\Code\Admin3

# Step 1: Create Railway project
railway login  # Already done (token in .env)
railway init

# When prompted:
# - Project name: admin3-uat
# - Create new project: Yes
# - Link to existing: No

# Step 2: Create UAT environment
railway environment create uat

# Step 3: Link to UAT environment
railway environment uat
```

### 5.3 Database Service Setup

```bash
# Step 1: Add PostgreSQL database
railway add --database postgresql

# This creates a PostgreSQL service with auto-generated credentials

# Step 2: Verify database is running
railway run --service postgres env | grep DATABASE_URL

# Step 3: Run initial migrations (after backend is set up)
# Will be done in backend setup section
```

### 5.4 Backend Service Setup

```bash
# Navigate to backend directory
cd backend/django_Admin3

# Step 1: Create backend service
railway service create admin3-backend

# Step 2: Link to backend service
railway service admin3-backend

# Step 3: Set environment variables
railway variables set DJANGO_SETTINGS_MODULE=django_Admin3.settings.uat
railway variables set DJANGO_ENV=uat
railway variables set DEBUG=False

# Step 4: Generate and set Django secret key
$SECRET_KEY = -join ((65..90) + (97..122) + (48..57) | Get-Random -Count 50 | ForEach-Object {[char]$_})
railway variables set DJANGO_SECRET_KEY=$SECRET_KEY

# Step 5: Link database to backend
# Railway automatically provides DATABASE_URL reference
# Set additional DB variables
railway variables set DB_NAME='${{admin3-postgres.PGDATABASE}}'
railway variables set DB_USER='${{admin3-postgres.PGUSER}}'
railway variables set DB_PASSWORD='${{admin3-postgres.PGPASSWORD}}'
railway variables set DB_HOST='${{admin3-postgres.PGHOST}}'
railway variables set DB_PORT='${{admin3-postgres.PGPORT}}'

# Step 6: Set CORS and CSRF (will update after frontend deployment)
railway variables set ALLOWED_HOSTS='${{RAILWAY_PUBLIC_DOMAIN}},${{RAILWAY_PRIVATE_DOMAIN}}'

# Step 7: Set external API credentials
railway variables set ADMINISTRATE_INSTANCE_URL="your-value"
railway variables set ADMINISTRATE_API_URL="your-value"
railway variables set ADMINISTRATE_API_KEY="your-value"
railway variables set ADMINISTRATE_API_SECRET="your-value"
railway variables set GETADDRESS_API_KEY="your-value"

# Step 8: Deploy backend
railway up --service admin3-backend

# Step 9: Run migrations
railway run --service admin3-backend python manage.py migrate

# Step 10: Create superuser
railway run --service admin3-backend python manage.py createsuperuser

# Step 11: Generate domain
railway domain generate

# Note the backend domain (e.g., admin3-backend-production.up.railway.app)
```

### 5.5 Frontend Service Setup

```bash
# Navigate to frontend directory
cd ../../frontend/react-Admin3

# Step 1: Create frontend service
railway service create admin3-frontend

# Step 2: Link to frontend service
railway service admin3-frontend

# Step 3: Set environment variables
railway variables set NODE_ENV=production
railway variables set REACT_APP_ENVIRONMENT=uat
railway variables set GENERATE_SOURCEMAP=false

# Step 4: Reference backend URL
railway variables set REACT_APP_API_URL='https://${{admin3-backend.RAILWAY_PUBLIC_DOMAIN}}'
railway variables set REACT_APP_BACKEND_URL='https://${{admin3-backend.RAILWAY_PUBLIC_DOMAIN}}'

# Step 5: Deploy frontend
railway up --service admin3-frontend

# Step 6: Generate domain
railway domain generate

# Note the frontend domain (e.g., admin3-frontend-production.up.railway.app)
```

### 5.6 Update Backend CORS Configuration

```bash
# Navigate back to backend
cd ../../backend/django_Admin3

# Update CORS with frontend domain
railway service admin3-backend
railway variables set CORS_ALLOWED_ORIGINS='https://<frontend-domain>'
railway variables set CSRF_TRUSTED_ORIGINS='https://<backend-domain>,https://<frontend-domain>'
railway variables set FRONTEND_URL='https://<frontend-domain>'

# Redeploy backend
railway up --service admin3-backend
```

### 5.7 Configure Auto-Deployment from GitHub

```bash
# Navigate to project root
cd C:\Code\Admin3

# Step 1: Create and push UAT branch
git checkout -b uat
git push -u origin uat

# Step 2: Configure Railway to watch UAT branch
# This is done via Railway Dashboard:
# 1. Go to railway.app
# 2. Select admin3-uat project
# 3. For each service (backend, frontend):
#    - Click service -> Settings
#    - Under "Source", click "Configure"
#    - Select repository: Admin3
#    - Set branch: uat
#    - Set root directory:
#      * Backend: backend/django_Admin3
#      * Frontend: frontend/react-Admin3
#    - Save changes

# Future deployments: Just push to UAT branch
git add .
git commit -m "Update for UAT deployment"
git push origin uat  # Auto-deploys to Railway
```

---

## 6. Post-Deployment Configuration

### 6.1 Database Initialization

```bash
# Run migrations
railway run --service admin3-backend python manage.py migrate

# Load initial data (if you have fixtures)
railway run --service admin3-backend python manage.py loaddata initial_data

# Create superuser
railway run --service admin3-backend python manage.py createsuperuser

# Import subjects (if needed)
railway run --service admin3-backend python manage.py import_subjects

# Setup rules engine
railway run --service admin3-backend python manage.py shell < setup_tc_rules.py
```

### 6.2 Health Check Endpoints

Create `backend/django_Admin3/utils/views.py` (if not exists):

```python
from django.http import JsonResponse
from django.db import connection

def health_check(request):
    """Health check endpoint for Railway"""
    try:
        # Check database connection
        with connection.cursor() as cursor:
            cursor.execute("SELECT 1")

        return JsonResponse({
            "status": "healthy",
            "database": "connected"
        })
    except Exception as e:
        return JsonResponse({
            "status": "unhealthy",
            "error": str(e)
        }, status=500)
```

Add to `backend/django_Admin3/django_Admin3/urls.py`:

```python
from utils.views import health_check

urlpatterns = [
    # ... existing patterns ...
    path('api/health/', health_check, name='health_check'),
]
```

### 6.3 Monitoring and Logs

```bash
# View backend logs
railway logs --service admin3-backend

# View frontend logs
railway logs --service admin3-frontend

# View database logs
railway logs --service admin3-postgres

# Follow logs in real-time
railway logs --service admin3-backend --follow
```

---

## 7. Cost Optimization for Minimal Traffic

### 7.1 Railway Pricing (As of 2025)

| Plan | Monthly Cost | Resources | Best For |
|------|--------------|-----------|----------|
| **Hobby** | $5/month | $5 usage credit | Testing/demos |
| **Pro** | $20/month | $20 usage credit | UAT/staging |

### 7.2 Estimated Monthly Costs (Minimal Traffic)

| Service | RAM | vCPU | Storage | Est. Cost/Month |
|---------|-----|------|---------|-----------------|
| PostgreSQL | 512MB | Shared | 1GB | ~$2-3 |
| Django Backend | 512MB | 0.5 | Ephemeral | ~$3-5 |
| React Frontend | 512MB | 0.5 | Ephemeral | ~$2-3 |
| **Total** | | | | **~$7-11** |

**Recommendation**: Start with **Hobby Plan** ($5/month) for initial testing. Upgrade to **Pro Plan** ($20/month) if traffic increases or you need more resources.

### 7.3 Cost Optimization Tips

1. **Sleep Unused Services**: Use Railway's auto-sleep feature for services with no traffic
2. **Shared Database**: Use single PostgreSQL instance for UAT
3. **Minimal Workers**: Django backend uses 2 Gunicorn workers (adjust based on traffic)
4. **Static Asset Optimization**: Enable compression in React build
5. **CDN (Future)**: For production, use Railway's CDN for static assets

---

## 8. Troubleshooting

### 8.1 Common Issues

#### Issue: Build Fails on Backend

**Solution**:
```bash
# Check build logs
railway logs --service admin3-backend

# Verify requirements.txt
railway run --service admin3-backend pip list

# Force rebuild
railway up --service admin3-backend --force
```

#### Issue: Database Connection Fails

**Solution**:
```bash
# Verify DATABASE_URL is set
railway run --service admin3-backend env | grep DATABASE_URL

# Test database connection
railway run --service admin3-backend python manage.py dbshell

# Check PostgreSQL service status
railway status --service admin3-postgres
```

#### Issue: CORS Errors

**Solution**:
```bash
# Verify CORS settings
railway variables --service admin3-backend | grep CORS

# Update CORS allowed origins
railway variables set CORS_ALLOWED_ORIGINS='https://<frontend-domain>'

# Redeploy
railway up --service admin3-backend
```

#### Issue: Static Files Not Serving

**Solution**:
```bash
# Run collectstatic
railway run --service admin3-backend python manage.py collectstatic --noinput

# Verify STATIC_ROOT
railway run --service admin3-backend python manage.py findstatic admin/css/base.css

# Check railway.json build command includes collectstatic
```

### 8.2 Debugging Commands

```bash
# SSH into backend container
railway shell --service admin3-backend

# Check environment variables
railway variables --service admin3-backend

# View deployment status
railway status

# Check service metrics
railway metrics --service admin3-backend

# Restart service
railway restart --service admin3-backend
```

---

## 9. Security Considerations

### 9.1 Environment Variables

- **NEVER** commit `.env` files to Git
- Use Railway's built-in secret management
- Rotate secrets regularly (especially `DJANGO_SECRET_KEY`)
- Use Railway's variable references for service-to-service communication

### 9.2 Django Security Checklist

```python
# Ensure these are set in uat.py
DEBUG = False
SECRET_KEY = env('DJANGO_SECRET_KEY')  # Strong random key
ALLOWED_HOSTS = [...]  # Specific domains only
SECURE_SSL_REDIRECT = True
SESSION_COOKIE_SECURE = True
CSRF_COOKIE_SECURE = True
SECURE_HSTS_SECONDS = 31536000
```

### 9.3 Database Security

- PostgreSQL credentials auto-generated by Railway (secure)
- SSL enforced for database connections
- Database backups enabled by default
- Restrict database access to Railway internal network only

### 9.4 API Security

- JWT authentication enabled
- CORS restricted to frontend domain only
- CSRF protection enabled
- Rate limiting (implement if needed)

---

## 10. Maintenance and Updates

### 10.1 Deployment Workflow

```bash
# 1. Develop locally on feature branch
git checkout -b feature/new-feature
# ... make changes ...
git commit -m "Add new feature"
git push origin feature/new-feature

# 2. Merge to develop via PR
# (GitHub PR process)

# 3. Test on develop branch locally
git checkout develop
git pull origin develop
# ... run tests ...

# 4. Deploy to UAT for stakeholder testing
git checkout uat
git merge develop --no-ff
git push origin uat  # Auto-deploys to Railway

# 5. Monitor deployment
railway logs --service admin3-backend --follow

# 6. If successful, promote to main (future production)
git checkout main
git merge uat --no-ff
git push origin main
```

### 10.2 Database Migrations

```bash
# Create migrations locally
python manage.py makemigrations

# Test migrations locally
python manage.py migrate

# Commit migrations
git add */migrations/*.py
git commit -m "Add database migrations for [feature]"

# Push to UAT (auto-deploys with migrations)
git push origin uat

# Railway automatically runs migrations via Procfile release command
# Monitor migration logs
railway logs --service admin3-backend | grep "Applying migrations"
```

### 10.3 Rollback Strategy

```bash
# If deployment fails, rollback to previous deployment
railway rollback --service admin3-backend

# Or revert Git changes and redeploy
git checkout uat
git revert HEAD
git push origin uat  # Triggers new deployment with previous code

# For database rollbacks (use with caution)
railway run --service admin3-backend python manage.py migrate <app_name> <migration_number>
```

---

## 11. Next Steps & Production Considerations

### 11.1 Future Production Deployment

When ready to deploy to production:

1. **Create Production Environment**:
   ```bash
   railway environment create production
   ```

2. **Upgrade Resources**:
   - PostgreSQL: 2GB RAM, 10GB storage
   - Django Backend: 1GB RAM, 1 vCPU, 3-4 workers
   - React Frontend: Consider CDN or static hosting

3. **Enable Monitoring**:
   - Set up Railway metrics and alerts
   - Implement application monitoring (e.g., Sentry)
   - Configure uptime monitoring (e.g., UptimeRobot)

4. **Custom Domain**:
   ```bash
   railway domain add admin3.yourdomain.com
   railway domain add api.admin3.yourdomain.com
   ```

5. **Scaling Strategy**:
   - Enable horizontal scaling for backend (multiple instances)
   - Implement Redis for caching and sessions
   - Use Railway's autoscaling features

### 11.2 Additional Services to Consider

- **Redis**: For caching and session storage
- **Celery Workers**: For background tasks (email processing, etc.)
- **Object Storage**: For media files (Railway Volumes or S3)
- **CDN**: For static asset delivery

---

## 12. Quick Reference

### 12.1 Essential Commands

```bash
# Authentication
railway login

# Project Management
railway init                          # Initialize project
railway link                          # Link to existing project
railway environment                   # List environments
railway environment uat               # Switch to UAT environment

# Service Management
railway service                       # List services
railway service admin3-backend        # Switch to backend service
railway add --database postgresql     # Add database

# Deployment
railway up                            # Deploy current service
railway up --service admin3-backend   # Deploy specific service
railway up --detach                   # Deploy without streaming logs

# Variables
railway variables                     # List variables
railway variables set KEY=value       # Set variable
railway variables unset KEY           # Remove variable

# Monitoring
railway logs                          # View logs
railway logs --follow                 # Follow logs in real-time
railway status                        # Check service status
railway metrics                       # View metrics

# Domain Management
railway domain                        # List domains
railway domain generate               # Generate Railway domain
railway domain add custom.com         # Add custom domain

# Utilities
railway run python manage.py migrate  # Run Django commands
railway shell                         # SSH into container
railway restart                       # Restart service
```

### 12.2 Railway Service URLs

After deployment, you'll have:

- **Backend API**: `https://admin3-backend-uat.up.railway.app`
- **Frontend**: `https://admin3-frontend-uat.up.railway.app`
- **PostgreSQL**: Internal only (via `DATABASE_URL`)

### 12.3 Important Files

```
Admin3/
├── backend/django_Admin3/
│   ├── railway.json              # Railway backend config
│   ├── Procfile                  # Process commands
│   ├── runtime.txt               # Python version
│   ├── requirements.txt          # Python dependencies
│   └── django_Admin3/settings/
│       └── uat.py                # UAT-specific settings
├── frontend/react-Admin3/
│   ├── railway.json              # Railway frontend config
│   ├── .env.production           # Production env vars
│   └── package.json              # Node dependencies
└── docs/
    └── railway-deployment-architecture.md  # This document
```

---

## Appendix A: Environment Variables Reference

### Backend Environment Variables

| Variable | Example | Description |
|----------|---------|-------------|
| `DJANGO_SETTINGS_MODULE` | `django_Admin3.settings.uat` | Django settings module |
| `DJANGO_ENV` | `uat` | Environment name |
| `DJANGO_SECRET_KEY` | `<random-50-chars>` | Django secret key |
| `DEBUG` | `False` | Debug mode (always False in UAT/prod) |
| `ALLOWED_HOSTS` | `${RAILWAY_PUBLIC_DOMAIN}` | Allowed host domains |
| `DATABASE_URL` | `postgresql://user:pass@host:5432/db` | Database connection string |
| `CORS_ALLOWED_ORIGINS` | `https://frontend.railway.app` | CORS allowed origins |
| `CSRF_TRUSTED_ORIGINS` | `https://backend.railway.app` | CSRF trusted origins |
| `FRONTEND_URL` | `https://frontend.railway.app` | Frontend URL |
| `BACKEND_URL` | `https://backend.railway.app` | Backend URL |

### Frontend Environment Variables

| Variable | Example | Description |
|----------|---------|-------------|
| `NODE_ENV` | `production` | Node environment |
| `REACT_APP_API_URL` | `https://backend.railway.app` | Backend API URL |
| `REACT_APP_BACKEND_URL` | `https://backend.railway.app` | Backend URL |
| `REACT_APP_ENVIRONMENT` | `uat` | Environment name |
| `GENERATE_SOURCEMAP` | `false` | Generate source maps (false for prod) |

---

## Appendix B: Branching Strategy Visualization

```
┌─────────────────────────────────────────────────────────────┐
│                    Git Workflow Timeline                     │
└─────────────────────────────────────────────────────────────┘

main        ●─────────────────────────●───────────────────────►
             │                         │
             │                     [Production Release]
             │
develop      ●───●───●───●───●───●───●───●───●───●───────────►
             │   │   │   │   │   │   │   │   │   │
             │   │   │   │   │   │   │   │   │   └─ bugfix/fix-001
             │   │   │   │   │   │   │   │   │
             │   │   │   │   │   │   │   │   └─ feature/feat-003
             │   │   │   │   │   │   │   │
             │   │   │   │   │   │   │   └─ feature/feat-002
             │   │   │   │   │   │   │
             │   │   │   │   │   │   └─ Merge to UAT
             │   │   │   │   │   │
             │   │   │   │   │   └─ feature/feat-001
             │   │   │   │   │
             │   │   │   │   └─ Sprint planning
             │   │   │   │
             │   │   │   └─ Integration testing
             │   │   │
             │   │   └─ Code review
             │   │
             │   └─ Development
             │
uat          ●───────────────────────●────────●──────────────►
             │                       │        │
             │                       │        └─ Hotfix deployed
             │                       │
             │                   [UAT Testing]
             │                   Auto-deploy from 'uat' branch
             │                   Stakeholder approval
             │
             └─ Initial UAT environment setup


Legend:
  ● = Merge/Deploy point
  ─ = Timeline progression
  └─ = Branch/annotation
```

---

## Document Control

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2025-10-15 | Winston (Architect) | Initial comprehensive deployment architecture |

---

**End of Railway Deployment Architecture Document**
