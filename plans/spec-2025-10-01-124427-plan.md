# Implementation Plan: Tutorial Product Card Speed Dial UI Enhancement

**Branch**: `tutorial-speed-dial-enhancement` | **Date**: 2025-10-01 | **Spec**: `specs/spec-2025-10-01-124427.md`
**Input**: Feature specification from `specs/spec-2025-10-01-124427.md`

## Execution Flow (/plan command scope)
```
1. Load feature spec from Input path
   → Spec loaded successfully from specs/spec-2025-10-01-124427.md
2. Fill Technical Context (scan for NEEDS CLARIFICATION)
   → Detect Project Type: web (frontend React + backend Django)
   → Set Structure Decision: Option 2 (Web application)
   → No NEEDS CLARIFICATION - all technical context is clear from existing codebase
3. Fill the Constitution Check section
   → Constitution check based on CLAUDE.md
4. Evaluate Constitution Check section
   → TDD compliance required (80% coverage minimum)
   → Update Progress Tracking: Initial Constitution Check
5. Execute Phase 0 → research.md
   → No unknowns to research (brownfield enhancement following existing pattern)
6. Execute Phase 1 → contracts, data-model.md, quickstart.md, CLAUDE.md update
   → UI-only change: No API contracts or data model changes
   → Quickstart: Component interaction testing approach
7. Re-evaluate Constitution Check section
   → No new violations
   → Update Progress Tracking: Post-Design Constitution Check
8. Plan Phase 2 → Describe task generation approach
9. STOP - Ready for /tasks command
```

**IMPORTANT**: The /plan command STOPS at step 7. Phases 2-4 are executed by other commands:
- Phase 2: /tasks command creates tasks.md
- Phase 3-4: Implementation execution (manual or via tools)

## Summary

Replace separate action buttons in TutorialProductCard component with a Material-UI SpeedDial component for a cleaner, more modern interface. This is a brownfield UI enhancement that consolidates three separate buttons ("Select Tutorial", "View Selection", "Add to Cart") into a single floating action button with expandable actions. The implementation follows the existing EnhancedTutorialProductCard pattern already present in the style guide.

**Technical Approach**: Modify TutorialProductCard.js to replace existing button group with SpeedDial, SpeedDialAction, and SpeedDialIcon components. Add conditional rendering logic for actions based on tutorial selection state. Implement backdrop overlay for improved UX. Follow TDD approach with component tests before implementation.

## Technical Context

**Language/Version**: React 19.1.0, JavaScript ES6+
**Primary Dependencies**: @mui/material 7.1.0, @mui/icons-material 7.1.1, React hooks (useState, useEffect)
**Storage**: N/A (UI-only change, uses existing TutorialChoiceContext for state)
**Testing**: Jest + React Testing Library (@testing-library/react 16.3.0, @testing-library/jest-dom 6.6.3)
**Target Platform**: Web browsers (Chrome, Firefox, Safari - as per package.json browserslist)
**Project Type**: web (React frontend + Django backend)
**Performance Goals**: < 300ms animation time for Speed Dial interactions, no impact on page load
**Constraints**:
- Must maintain existing functionality (no regression)
- Must follow Material-UI component patterns
- Must support keyboard navigation and screen readers
- Must work on mobile and desktop (responsive)
**Scale/Scope**: Single component modification in tutorial product catalog (frontend-only)

## Constitution Check
*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

**TDD Compliance** ✅
- **Requirement**: Minimum 80% test coverage for new code
- **Approach**: Write component tests before implementing Speed Dial changes
- **Test Strategy**:
  - Test Speed Dial rendering and visibility
  - Test conditional action visibility based on `hasChoices` state
  - Test event handler integration (dialog open, panel open, add to cart)
  - Test backdrop overlay behavior
  - Test keyboard navigation and accessibility

**Code Quality** ✅
- **Requirement**: Follow existing patterns
- **Approach**: Reference EnhancedTutorialProductCard.js (lines 331-427) as the proven pattern
- **No new architecture**: Reuse existing TutorialChoiceContext, TutorialChoiceDialog, TutorialChoicePanel

**No Breaking Changes** ✅
- **Requirement**: Maintain all existing functionality
- **Approach**:
  - Keep all existing props and state management
  - Preserve event handler signatures
  - Run full test suite to verify no regressions
  - Manual testing of user workflows

## Project Structure

### Documentation (this feature)
```
specs/spec-2025-10-01-124427/
├── spec.md              # Feature specification (already created)
├── plan.md              # This file (/plan command output)
├── quickstart.md        # Phase 1 output (/plan command)
└── tasks.md             # Phase 2 output (/tasks command - NOT created by /plan)
```

### Source Code (repository root)
```
# Option 2: Web application (React frontend + Django backend)
frontend/react-Admin3/
├── src/
│   ├── components/
│   │   ├── Product/
│   │   │   └── ProductCard/
│   │   │       └── Tutorial/
│   │   │           ├── TutorialProductCard.js          # PRIMARY FILE TO MODIFY
│   │   │           ├── TutorialChoiceDialog.js         # Reference (no changes)
│   │   │           └── TutorialChoicePanel.js          # Reference (no changes)
│   │   └── styleguide/
│   │       └── ProductCards/
│   │           └── EnhancedTutorialProductCard.js      # REFERENCE PATTERN
│   ├── contexts/
│   │   └── TutorialChoiceContext.js                    # Reference (no changes)
│   └── __tests__/
│       └── components/
│           └── Product/
│               └── ProductCard/
│                   └── Tutorial/
│                       └── TutorialProductCard.test.js # NEW TEST FILE
└── package.json

backend/django_Admin3/
└── [No backend changes required]
```

**Structure Decision**: Option 2 (Web application) - Frontend React changes only, no backend modifications

## Phase 0: Outline & Research

**Extract unknowns from Technical Context**:
- ✅ All technical details are clear from existing codebase
- ✅ No NEEDS CLARIFICATION markers
- ✅ No new dependencies required (Material-UI SpeedDial already available)
- ✅ Pattern already exists in EnhancedTutorialProductCard.js

**Research Status**:
- No research required - this is a brownfield enhancement following an existing proven pattern
- Reference implementation already exists and tested in style guide
- All technical decisions already made in brownfield story document

**Output**: No research.md needed - all information available from existing codebase and brownfield story

## Phase 1: Design & Contracts

### Data Model
**Output**: No data-model.md needed - UI-only change with no data model modifications

**Existing State**:
- TutorialChoiceContext provides: `getSubjectChoices()`, `showChoicePanelForSubject()`
- Component local state: `showChoiceDialog`, `isHovered`, `selectedPriceType`
- **New local state needed**: `speedDialOpen` (boolean)

### API Contracts
**Output**: No contracts/ directory needed - No API changes

**Existing Integration Points**:
- TutorialChoiceDialog (component integration)
- TutorialChoicePanel (component integration)
- TutorialChoiceContext (state management)
- No new API calls required

### Component Contract (UI Behavior)

**TutorialProductCard Component Interface** (existing, unchanged):
```
Props:
- subjectCode: string (required)
- subjectName: string (required)
- location: string (required)
- productId: string | number (required)
- product: object (required)
- variations: array (optional)

Context Dependencies:
- TutorialChoiceContext: {
    getSubjectChoices,
    showChoicePanelForSubject
  }
```

**New Component Behavior**:
```
SpeedDial Visibility:
- Input: hasChoices (derived from getSubjectChoices(subjectCode))
- Output: 3 actions if hasChoices === true, 1 action if hasChoices === false

SpeedDial Actions:
1. "Add to Cart"
   - Visible: when hasChoices === true
   - Icon: <AddShoppingCart />
   - Handler: handleAddToCart() [to be implemented]

2. "Select Tutorial"
   - Visible: always
   - Icon: <CalendarMonthOutlined />
   - Handler: setShowChoiceDialog(true)

3. "View Selections"
   - Visible: when hasChoices === true
   - Icon: <ViewModule />
   - Handler: showChoicePanelForSubject(subjectCode)
```

### Test Scenarios (from spec acceptance scenarios)

**Test File**: `src/components/Product/ProductCard/Tutorial/__tests__/TutorialProductCard.test.js`

**Test Suites**:

1. **Speed Dial Rendering Tests**
   - Should render Speed Dial button in CardActions
   - Should display "+" icon when closed
   - Should not render separate "Select Tutorial" and "View Selection" buttons

2. **Conditional Action Visibility Tests**
   - Should show only "Select Tutorial" action when hasChoices is false
   - Should show all 3 actions when hasChoices is true
   - Should hide "Add to Cart" action when hasChoices is false
   - Should hide "View Selections" action when hasChoices is false

3. **Speed Dial Interaction Tests**
   - Should open Speed Dial when clicked
   - Should rotate icon 45 degrees when open
   - Should close Speed Dial when close button clicked
   - Should close Speed Dial when backdrop clicked
   - Should close Speed Dial after action clicked

4. **Event Handler Integration Tests**
   - Should open TutorialChoiceDialog when "Select Tutorial" clicked
   - Should call showChoicePanelForSubject when "View Selections" clicked
   - Should trigger add to cart when "Add to Cart" clicked

5. **Accessibility Tests**
   - Should support keyboard navigation (Tab, Enter, Escape)
   - Should have proper ARIA labels
   - Should have proper tooltip labels

6. **Regression Tests**
   - Should maintain all existing tutorial selection functionality
   - Should render loading state correctly
   - Should render error state correctly
   - Should render tutorial information section

### Quickstart Testing Approach

See `specs/spec-2025-10-01-124427/quickstart.md` for manual testing steps.

**Key Manual Test Flows**:
1. Visual verification: Single Speed Dial button replaces separate buttons
2. Interaction test: Click Speed Dial → Verify actions expand
3. Conditional test: Clear selections → Verify actions hidden
4. Integration test: Click "Select Tutorial" → Verify dialog opens
5. Integration test: Click "View Selections" → Verify panel opens
6. Regression test: Complete tutorial selection workflow → Verify no breaks

### Agent File Update

Update CLAUDE.md with this feature (incremental O(1) operation):

**Recent Changes section** (keep last 3):
```markdown
## Recent Changes
1. **Tutorial Product Card Speed Dial Enhancement** (2025-10-01)
   - Replaced separate action buttons with Material-UI SpeedDial component
   - Conditional action visibility based on tutorial selection state
   - Files: frontend/react-Admin3/src/components/Product/ProductCard/Tutorial/TutorialProductCard.js

[... keep 2 previous changes ...]
```

**Output**: Update CLAUDE.md "Recent Changes" section only (preserve all other content)

## Phase 2: Task Planning Approach
*This section describes what the /tasks command will do - DO NOT execute during /plan*

**Task Generation Strategy**:
1. Load `.specify/templates/tasks-template.md` as base
2. Generate tasks from Phase 1 quickstart test scenarios
3. Follow TDD order: RED → GREEN → REFACTOR

**Task Sequence** (estimated):

**RED Phase Tasks** (Write failing tests):
- TASK-001: Create test file and setup
- TASK-002: Write Speed Dial rendering tests
- TASK-003: Write conditional visibility tests
- TASK-004: Write interaction behavior tests
- TASK-005: Write event handler integration tests
- TASK-006: Write accessibility tests
- TASK-007: Write regression tests

**GREEN Phase Tasks** (Implement to pass tests):
- TASK-008: Add SpeedDial imports and state
- TASK-009: Replace button group with SpeedDial component
- TASK-010: Implement conditional action filtering
- TASK-011: Wire up event handlers
- TASK-012: Add backdrop overlay
- TASK-013: Implement accessibility features

**REFACTOR Phase Tasks** (Improve code quality):
- TASK-014: Extract actions configuration to constant
- TASK-015: Add PropTypes validation
- TASK-016: Optimize re-renders with useMemo/useCallback
- TASK-017: Clean up unused code and imports

**VALIDATION Tasks**:
- TASK-018: Run full test suite
- TASK-019: Manual quickstart testing
- TASK-020: Cross-browser testing
- TASK-021: Mobile responsiveness testing

**Ordering Strategy**:
- TDD order: Tests before implementation (RED before GREEN)
- Dependency order: State setup before rendering logic
- No parallel tasks: All tasks sequential due to single file modification

**Estimated Output**: 21 numbered, ordered tasks in tasks.md

**Time Estimate**:
- RED Phase: 2 hours (7 tasks × ~15-20 min each)
- GREEN Phase: 2 hours (6 tasks × ~20 min each)
- REFACTOR Phase: 1 hour (4 tasks × ~15 min each)
- VALIDATION: 1 hour (4 tasks × ~15 min each)
- **Total**: ~6 hours (fits within single development session with buffer)

**IMPORTANT**: This phase is executed by the /tasks command, NOT by /plan

## Phase 3+: Future Implementation
*These phases are beyond the scope of the /plan command*

**Phase 3**: Task execution (/tasks command creates tasks.md with 21 TDD tasks)
**Phase 4**: Implementation (execute tasks.md following TDD principles)
**Phase 5**: Validation (run tests, execute quickstart.md, cross-browser testing)

## Complexity Tracking
*No constitution violations - this is a straightforward brownfield enhancement*

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| None      | N/A        | N/A                                 |

**Justification for simplicity**:
- Single file modification (TutorialProductCard.js)
- Follows existing proven pattern (EnhancedTutorialProductCard.js)
- No new dependencies
- No API or database changes
- No new architecture or abstractions

## Progress Tracking
*This checklist is updated during execution flow*

**Phase Status**:
- [x] Phase 0: Research complete (N/A - brownfield enhancement)
- [x] Phase 1: Design complete (quickstart.md created)
- [x] Phase 2: Task planning approach described
- [ ] Phase 3: Tasks generated (/tasks command)
- [ ] Phase 4: Implementation complete
- [ ] Phase 5: Validation passed

**Gate Status**:
- [x] Initial Constitution Check: PASS (TDD compliance, no breaking changes)
- [x] Post-Design Constitution Check: PASS (follows existing patterns)
- [x] All NEEDS CLARIFICATION resolved (none existed)
- [x] Complexity deviations documented (none - straightforward change)

---

## Next Steps

Run `/tasks` to generate the detailed TDD task breakdown in `tasks/spec-2025-10-01-124427-tasks.md`.

The `/tasks` command will create 21 numbered tasks following RED-GREEN-REFACTOR cycle with specific file paths, test expectations, and time estimates.

---
*Based on CLAUDE.md TDD requirements - See `/CLAUDE.md`*
