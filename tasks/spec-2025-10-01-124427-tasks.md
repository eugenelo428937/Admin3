# Tasks: Tutorial Product Card Speed Dial UI Enhancement

**Input**: Design documents from `specs/spec-2025-10-01-124427/` and `plans/spec-2025-10-01-124427-plan.md`
**Prerequisites**: plan.md ✅, quickstart.md ✅ (no research.md, data-model.md, or contracts needed - UI-only change)

## Execution Flow (main)
```
1. Load plan.md from feature directory
   → Loaded: plans/spec-2025-10-01-124427-plan.md
   → Tech stack: React 19.1.0, Material-UI 7.1.0, Jest + RTL
   → Structure: Web app (frontend only)
2. Load optional design documents:
   → data-model.md: N/A (UI-only change)
   → contracts/: N/A (no API changes)
   → quickstart.md: ✅ Loaded - 10 test scenarios extracted
3. Generate tasks by category:
   → Setup: Test file creation, imports
   → Tests: Component rendering, interaction, accessibility (TDD RED phase)
   → Core: SpeedDial implementation (TDD GREEN phase)
   → Integration: Event handlers, context integration
   → Polish: Refactoring, optimization (TDD REFACTOR phase)
4. Apply task rules:
   → Single file modification = all tasks sequential (no [P] markers)
   → Tests before implementation (TDD mandatory)
5. Number tasks sequentially (T001-T021)
6. Generate dependency graph
7. Validate task completeness:
   → All test scenarios covered? ✅
   → TDD phases complete? ✅ (RED → GREEN → REFACTOR)
8. Return: SUCCESS (21 tasks ready for execution)
```

## Format: `[ID] Description`
- No [P] markers - all tasks sequential (single file modification)
- Include exact file paths in descriptions
- Follow TDD: RED → GREEN → REFACTOR

## Path Conventions
- **Frontend**: `frontend/react-Admin3/src/components/Product/ProductCard/Tutorial/TutorialProductCard.js`
- **Tests**: `frontend/react-Admin3/src/components/Product/ProductCard/Tutorial/__tests__/TutorialProductCard.test.js`
- **Reference**: `frontend/react-Admin3/src/components/styleguide/ProductCards/EnhancedTutorialProductCard.js`

---

## Phase 3.1: Setup (5 minutes)

### T001: Create test file structure
**File**: `frontend/react-Admin3/src/components/Product/ProductCard/Tutorial/__tests__/TutorialProductCard.test.js`
**Action**: Create new test file with basic setup
**Details**:
- Create `__tests__` directory if not exists
- Create `TutorialProductCard.test.js`
- Add imports: React, @testing-library/react, @testing-library/jest-dom, @testing-library/user-event
- Add TutorialProductCard import
- Add mock for TutorialChoiceContext
- Add basic test suite structure

**Success Criteria**:
- File created with proper imports
- Test file runs without errors (even with no tests)
- Mock context provider setup complete

**Time Estimate**: 5 minutes

---

## Phase 3.2: Tests First (TDD RED Phase) ⚠️ MUST COMPLETE BEFORE 3.3
**CRITICAL: These tests MUST be written and MUST FAIL before ANY implementation**
**Total Time: ~2 hours**

### T002: Test Speed Dial rendering
**File**: `frontend/react-Admin3/src/components/Product/ProductCard/Tutorial/__tests__/TutorialProductCard.test.js`
**TDD Stage**: RED
**Action**: Write tests for Speed Dial button rendering
**Tests to Add**:
1. Should render Speed Dial button in CardActions
2. Should display "+" icon when closed (SpeedDialIcon component)
3. Should NOT render separate "Select Tutorial" button in card body
4. Should NOT render separate "View Selection" button in card body

**Mock Data**:
```javascript
const mockProps = {
  subjectCode: 'CS1',
  subjectName: 'Core Statistics 1',
  location: 'Birmingham',
  productId: '123',
  product: { subject_code: 'CS1' },
  variations: []
};
```

**Expected**: All 4 tests should FAIL (Speed Dial not implemented yet)

**Time Estimate**: 20 minutes

---

### T003: Test conditional action visibility - no selections
**File**: `frontend/react-Admin3/src/components/Product/ProductCard/Tutorial/__tests__/TutorialProductCard.test.js`
**TDD Stage**: RED
**Action**: Write tests for action visibility when no tutorials selected
**Tests to Add**:
1. Should show only "Select Tutorial" action when hasChoices is false
2. Should NOT show "Add to Cart" action when hasChoices is false
3. Should NOT show "View Selections" action when hasChoices is false
4. Should show calendar icon for "Select Tutorial" action

**Mock Context**:
```javascript
const mockContextNoChoices = {
  getSubjectChoices: () => ({}),  // Empty object = no choices
  showChoicePanelForSubject: jest.fn()
};
```

**Expected**: All 4 tests should FAIL (conditional logic not implemented)

**Time Estimate**: 20 minutes

---

### T004: Test conditional action visibility - with selections
**File**: `frontend/react-Admin3/src/components/Product/ProductCard/Tutorial/__tests__/TutorialProductCard.test.js`
**TDD Stage**: RED
**Action**: Write tests for action visibility when tutorials are selected
**Tests to Add**:
1. Should show 3 actions when hasChoices is true
2. Should show "Add to Cart" action with cart icon
3. Should show "Select Tutorial" action with calendar icon
4. Should show "View Selections" action with view icon
5. All actions should have proper tooltips

**Mock Context**:
```javascript
const mockContextWithChoices = {
  getSubjectChoices: () => ({ '1st': { /* choice data */ } }),
  showChoicePanelForSubject: jest.fn()
};
```

**Expected**: All 5 tests should FAIL (actions not implemented)

**Time Estimate**: 20 minutes

---

### T005: Test Speed Dial interaction behaviors
**File**: `frontend/react-Admin3/src/components/Product/ProductCard/Tutorial/__tests__/TutorialProductCard.test.js`
**TDD Stage**: RED
**Action**: Write tests for Speed Dial opening/closing
**Tests to Add**:
1. Should open Speed Dial when button clicked
2. Should close Speed Dial when close button clicked
3. Should close Speed Dial when backdrop clicked
4. Should close Speed Dial after action clicked
5. Should display backdrop overlay when open

**User Event Setup**:
```javascript
import userEvent from '@testing-library/user-event';
const user = userEvent.setup();
```

**Expected**: All 5 tests should FAIL (interaction logic not implemented)

**Time Estimate**: 25 minutes

---

### T006: Test event handler integrations
**File**: `frontend/react-Admin3/src/components/Product/ProductCard/Tutorial/__tests__/TutorialProductCard.test.js`
**TDD Stage**: RED
**Action**: Write tests for action click handlers
**Tests to Add**:
1. Should call setShowChoiceDialog(true) when "Select Tutorial" clicked
2. Should call showChoicePanelForSubject(subjectCode) when "View Selections" clicked
3. Should open TutorialChoiceDialog component when "Select Tutorial" clicked
4. Should trigger add to cart logic when "Add to Cart" clicked (future implementation)

**Expected**: All 4 tests should FAIL (handlers not wired)

**Time Estimate**: 20 minutes

---

### T007: Test accessibility features
**File**: `frontend/react-Admin3/src/components/Product/ProductCard/Tutorial/__tests__/TutorialProductCard.test.js`
**TDD Stage**: RED
**Action**: Write tests for keyboard navigation and ARIA
**Tests to Add**:
1. Should support Tab to focus Speed Dial button
2. Should support Enter to open Speed Dial
3. Should support Escape to close Speed Dial
4. Should have proper ARIA labels on actions
5. Should have proper tooltip labels

**Accessibility Testing**:
```javascript
const speedDial = screen.getByRole('button', { name: /speed dial/i });
expect(speedDial).toHaveAttribute('aria-label');
```

**Expected**: All 5 tests should FAIL (accessibility not implemented)

**Time Estimate**: 25 minutes

---

### T008: Test regression - existing functionality
**File**: `frontend/react-Admin3/src/components/Product/ProductCard/Tutorial/__tests__/TutorialProductCard.test.js`
**TDD Stage**: RED
**Action**: Write regression tests for existing features
**Tests to Add**:
1. Should render tutorial information section correctly
2. Should render discount options correctly
3. Should render price display correctly
4. Should handle loading state correctly
5. Should handle error state correctly
6. Should render TutorialChoiceDialog when showChoiceDialog is true

**Expected**: These tests may PASS initially (testing existing functionality), but ensure they continue to pass after implementation

**Time Estimate**: 20 minutes

---

**RED Phase Checkpoint**:
- [ ] All 7 test tasks complete (T002-T008)
- [ ] ~30 tests written total
- [ ] All new functionality tests FAILING
- [ ] Regression tests PASSING (or setup for verification)
- [ ] Test file runs successfully
- [ ] Run: `npm test TutorialProductCard` to verify all tests execute

**Time Total (RED Phase)**: ~2 hours 10 minutes

---

## Phase 3.3: Core Implementation (TDD GREEN Phase) - ONLY after tests are failing
**Total Time: ~2 hours**

### T009: Add SpeedDial imports and state
**File**: `frontend/react-Admin3/src/components/Product/ProductCard/Tutorial/TutorialProductCard.js`
**TDD Stage**: GREEN
**Action**: Add necessary imports and state management
**Changes**:
1. Import SpeedDial components:
   ```javascript
   import SpeedDial from "@mui/material/SpeedDial";
   import SpeedDialAction from "@mui/material/SpeedDialAction";
   import SpeedDialIcon from "@mui/material/SpeedDialIcon";
   ```
2. Add state:
   ```javascript
   const [speedDialOpen, setSpeedDialOpen] = useState(false);
   ```
3. Add handlers:
   ```javascript
   const handleSpeedDialOpen = () => setSpeedDialOpen(true);
   const handleSpeedDialClose = () => setSpeedDialOpen(false);
   ```

**Tests Expected to Pass**: None yet (just setup)

**Time Estimate**: 10 minutes

---

### T010: Remove existing button group from card body
**File**: `frontend/react-Admin3/src/components/Product/ProductCard/Tutorial/TutorialProductCard.js`
**TDD Stage**: GREEN
**Action**: Remove separate action buttons
**Changes**:
1. Locate lines 312-341 (tutorial-action-buttons Box)
2. Delete the entire Box containing:
   - "Select Tutorial" button
   - "View Selection" button (conditional)
3. Keep tutorial-info-section intact

**Reference**: See brownfield story lines 27-30 for exact removal targets

**Tests Expected to Pass**:
- T002 tests 3 & 4 (buttons no longer render)

**Time Estimate**: 5 minutes

---

### T011: Implement SpeedDial component structure
**File**: `frontend/react-Admin3/src/components/Product/ProductCard/Tutorial/TutorialProductCard.js`
**TDD Stage**: GREEN
**Action**: Add SpeedDial to CardActions section
**Changes**:
1. In CardActions, after price-action-section Box, add SpeedDial:
   ```javascript
   <Box sx={{ position: "relative", width: "100%", zIndex: 9000 }}>
     <SpeedDial
       ariaLabel="Tutorial actions"
       icon={<SpeedDialIcon />}
       direction="up"
       onOpen={handleSpeedDialOpen}
       onClose={handleSpeedDialClose}
       open={speedDialOpen}
       FabProps={{
         size: "medium",
         color: "primary",
         onClick: () => setSpeedDialOpen((prev) => !prev),
       }}
       sx={{
         position: "absolute",
         bottom: 0,
         right: 0,
         zIndex: 9000,
       }}
       className="tutorial-speed-dial"
     >
       {/* Actions will be added in next task */}
     </SpeedDial>
   </Box>
   ```

**Reference**: EnhancedTutorialProductCard.js lines 331-350

**Tests Expected to Pass**:
- T002 tests 1 & 2 (Speed Dial renders with + icon)

**Time Estimate**: 15 minutes

---

### T012: Implement SpeedDialActions with conditional visibility
**File**: `frontend/react-Admin3/src/components/Product/ProductCard/Tutorial/TutorialProductCard.js`
**TDD Stage**: GREEN
**Action**: Add SpeedDialAction components with conditional rendering
**Changes**:
1. Define actions array before return statement:
   ```javascript
   const actions = [
     { icon: <AddShoppingCart />, name: "Add to Cart", show: hasChoices },
     { icon: <CalendarMonthOutlined />, name: "Select Tutorial", show: true },
     { icon: <ViewModule />, name: "View selections", show: hasChoices },
   ].filter(action => action.show);
   ```

2. Map actions inside SpeedDial:
   ```javascript
   {actions.map((action) => (
     <SpeedDialAction
       key={action.name}
       icon={action.icon}
       tooltipTitle={action.name}
       onClick={() => handleActionClick(action.name)}
     />
   ))}
   ```

**Reference**: EnhancedTutorialProductCard.js lines 352-379

**Tests Expected to Pass**:
- T003 all tests (no selections = 1 action)
- T004 all tests (with selections = 3 actions)

**Time Estimate**: 20 minutes

---

### T013: Wire up action event handlers
**File**: `frontend/react-Admin3/src/components/Product/ProductCard/Tutorial/TutorialProductCard.js`
**TDD Stage**: GREEN
**Action**: Implement action click handler logic
**Changes**:
1. Add handleActionClick function:
   ```javascript
   const handleActionClick = (actionName) => {
     if (actionName === "Select Tutorial") {
       setShowChoiceDialog(true);
     } else if (actionName === "View selections") {
       showChoicePanelForSubject(subjectCode);
     } else if (actionName === "Add to Cart") {
       // TODO: Implement add to cart logic (future enhancement)
       console.log("Add to cart clicked");
     }
     handleSpeedDialClose();
   };
   ```

**Tests Expected to Pass**:
- T006 tests 1 & 2 (dialog and panel handlers)
- T005 test 4 (closes after action click)

**Time Estimate**: 15 minutes

---

### T014: Add backdrop overlay
**File**: `frontend/react-Admin3/src/components/Product/ProductCard/Tutorial/TutorialProductCard.js`
**TDD Stage**: GREEN
**Action**: Implement backdrop for better UX
**Changes**:
1. After SpeedDial closing tag, add backdrop:
   ```javascript
   {speedDialOpen && (
     <Box
       onClick={handleSpeedDialClose}
       sx={{
         position: 'fixed',
         inset: 0,
         zIndex: (theme) => theme.zIndex.speedDial - 1,
         pointerEvents: 'auto',
         backgroundImage: `radial-gradient(
           circle at 98% 96%,
           rgba(0,0,0,0.28) 0px,
           rgba(0,0,0,0.20) 120px,
           rgba(0,0,0,0.12) 240px,
           rgba(0,0,0,0.06) 420px,
           rgba(0,0,0,0.0) 65%
         )`,
         transition: 'background 200ms ease-out',
       }}
     />
   )}
   ```

**Reference**: EnhancedTutorialProductCard.js lines 415-427

**Tests Expected to Pass**:
- T005 test 3 (backdrop click closes)
- T005 test 5 (backdrop renders when open)

**Time Estimate**: 10 minutes

---

### T015: Implement keyboard navigation and accessibility
**File**: `frontend/react-Admin3/src/components/Product/ProductCard/Tutorial/TutorialProductCard.js`
**TDD Stage**: GREEN
**Action**: Add ARIA labels and keyboard support
**Changes**:
1. Update SpeedDialAction to include explicit tooltips:
   ```javascript
   <SpeedDialAction
     key={action.name}
     icon={action.icon}
     slotProps={{
       tooltip: {
         open: true,
         title: action.name,
       },
     }}
     sx={{
       "& .MuiSpeedDialAction-staticTooltipLabel": {
         whiteSpace: "nowrap",
         maxWidth: "none",
       },
     }}
     onClick={() => handleActionClick(action.name)}
   />
   ```

2. Ensure SpeedDial has proper aria-label (already added in T011)

**Reference**: EnhancedTutorialProductCard.js lines 356-368

**Tests Expected to Pass**:
- T007 all tests (accessibility and keyboard)

**Time Estimate**: 15 minutes

---

**GREEN Phase Checkpoint**:
- [ ] All 7 implementation tasks complete (T009-T015)
- [ ] All failing tests from RED phase now PASSING
- [ ] Run: `npm test TutorialProductCard` to verify
- [ ] Visual inspection: Speed Dial appears and functions

**Time Total (GREEN Phase)**: ~1 hour 30 minutes

---

## Phase 3.4: Polish (TDD REFACTOR Phase)
**Total Time: ~1 hour**

### T016: Extract actions configuration to constant
**File**: `frontend/react-Admin3/src/components/Product/ProductCard/Tutorial/TutorialProductCard.js`
**TDD Stage**: REFACTOR
**Action**: Refactor actions array to improve readability
**Changes**:
1. Move actions definition outside component or to useMemo:
   ```javascript
   const speedDialActions = useMemo(() => [
     {
       icon: <AddShoppingCart />,
       name: "Add to Cart",
       show: hasChoices,
       handler: "addToCart"
     },
     {
       icon: <CalendarMonthOutlined />,
       name: "Select Tutorial",
       show: true,
       handler: "selectTutorial"
     },
     {
       icon: <ViewModule />,
       name: "View selections",
       show: hasChoices,
       handler: "viewSelections"
     },
   ].filter(action => action.show), [hasChoices]);
   ```

**Tests Expected**: All tests remain PASSING (refactor only)

**Time Estimate**: 15 minutes

---

### T017: Optimize re-renders with useCallback
**File**: `frontend/react-Admin3/src/components/Product/ProductCard/Tutorial/TutorialProductCard.js`
**TDD Stage**: REFACTOR
**Action**: Memoize event handlers to prevent unnecessary re-renders
**Changes**:
1. Wrap handlers in useCallback:
   ```javascript
   const handleSpeedDialOpen = useCallback(() => setSpeedDialOpen(true), []);
   const handleSpeedDialClose = useCallback(() => setSpeedDialOpen(false), []);
   const handleActionClick = useCallback((actionName) => {
     // ... existing logic
   }, [subjectCode, showChoicePanelForSubject]);
   ```

**Tests Expected**: All tests remain PASSING

**Time Estimate**: 10 minutes

---

### T018: Clean up unused code and imports
**File**: `frontend/react-Admin3/src/components/Product/ProductCard/Tutorial/TutorialProductCard.js`
**TDD Stage**: REFACTOR
**Action**: Remove any unused imports or commented code
**Changes**:
1. Verify all imports are used
2. Remove any commented-out button code
3. Ensure no console.logs remain (except intentional TODOs)
4. Format code consistently

**Tests Expected**: All tests remain PASSING

**Time Estimate**: 10 minutes

---

### T019: Add PropTypes documentation
**File**: `frontend/react-Admin3/src/components/Product/ProductCard/Tutorial/TutorialProductCard.js`
**TDD Stage**: REFACTOR
**Action**: Verify PropTypes are complete and accurate
**Changes**:
1. Review existing PropTypes at bottom of file
2. Ensure all props still match after changes
3. No changes expected (props unchanged)

**Tests Expected**: All tests remain PASSING

**Time Estimate**: 5 minutes

---

**REFACTOR Phase Checkpoint**:
- [ ] All 4 refactor tasks complete (T016-T019)
- [ ] Code is clean and optimized
- [ ] All tests still PASSING
- [ ] Run: `npm test TutorialProductCard -- --coverage`
- [ ] Verify ≥80% coverage

**Time Total (REFACTOR Phase)**: ~40 minutes

---

## Phase 3.5: Validation & Testing
**Total Time: ~1 hour**

### T020: Run full test suite
**File**: N/A (command-line)
**Action**: Execute all tests and verify coverage
**Commands**:
```bash
cd frontend/react-Admin3
npm test TutorialProductCard -- --coverage --watchAll=false
```

**Success Criteria**:
- All tests passing (30+ tests)
- Coverage ≥ 80% for TutorialProductCard.js
- No console errors or warnings

**Time Estimate**: 5 minutes

---

### T021: Manual quickstart testing
**File**: N/A (manual testing)
**Reference**: `specs/spec-2025-10-01-124427/quickstart.md`
**Action**: Execute manual test scenarios 1-10
**Steps**:
1. Start dev server: `npm start`
2. Navigate to tutorial products page
3. Execute Scenarios 1-7 from quickstart.md
4. Document any issues found

**Success Criteria**:
- All 10 scenarios PASS
- No visual bugs
- Smooth animations
- Proper accessibility

**Time Estimate**: 25 minutes

---

### T022: Cross-browser testing
**File**: N/A (manual testing)
**Action**: Test in Chrome, Firefox, Safari, Edge
**Steps**:
1. Test Speed Dial interaction in each browser
2. Verify animations work smoothly
3. Test keyboard navigation in each browser
4. Test mobile view (responsive)

**Success Criteria**:
- Works in all 4 browsers
- No browser-specific bugs
- Mobile view responsive

**Time Estimate**: 20 minutes

---

### T023: Accessibility validation
**File**: N/A (manual testing)
**Action**: Test with screen reader and keyboard-only navigation
**Steps**:
1. Use screen reader (NVDA/JAWS/VoiceOver)
2. Navigate entire Speed Dial workflow with keyboard only
3. Verify all ARIA labels announced correctly
4. Verify focus management

**Success Criteria**:
- All elements accessible via keyboard
- Screen reader announces all actions
- Focus order is logical

**Time Estimate**: 15 minutes

---

**VALIDATION Phase Checkpoint**:
- [ ] All 4 validation tasks complete (T020-T023)
- [ ] Automated tests: 100% passing with ≥80% coverage
- [ ] Manual tests: All scenarios passing
- [ ] Cross-browser: No issues found
- [ ] Accessibility: WCAG AA compliant

**Time Total (VALIDATION Phase)**: ~65 minutes

---

## Dependencies

**TDD Flow**:
```
Setup (T001)
  ↓
RED Phase (T002-T008) → All tests must FAIL
  ↓
GREEN Phase (T009-T015) → Tests must PASS
  ↓
REFACTOR Phase (T016-T019) → Tests remain PASSING
  ↓
VALIDATION (T020-T023) → Final verification
```

**Sequential Dependencies**:
- T001 blocks T002-T008 (need test file)
- T002-T008 block T009 (tests must exist before implementation)
- T009 blocks T010-T015 (need imports and state)
- T010 blocks T011 (remove old before adding new)
- T011 blocks T012 (SpeedDial structure before actions)
- T012 blocks T013 (actions before handlers)
- T013 blocks T014 (handlers before backdrop)
- T014 blocks T015 (structure complete before accessibility)
- T015 blocks T016 (implementation complete before refactor)
- T019 blocks T020 (refactor complete before validation)

**No Parallel Tasks**: Single file modification requires sequential execution

---

## Task Summary

**Total Tasks**: 23 tasks
**Estimated Time**: ~6 hours 30 minutes

**Breakdown**:
- Setup: 5 min (1 task)
- RED Phase: 2h 10min (7 tasks)
- GREEN Phase: 1h 30min (7 tasks)
- REFACTOR Phase: 40 min (4 tasks)
- VALIDATION: 1h 5min (4 tasks)

**File Changes**:
- Modified: 1 file (TutorialProductCard.js)
- Created: 1 file (TutorialProductCard.test.js)
- Total Files: 2

**Test Coverage Goal**: ≥80% (30+ new tests)

---

## Notes for Implementation

1. **Strict TDD Enforcement**:
   - NEVER skip RED phase
   - Verify tests FAIL before implementing
   - Run tests after each GREEN task
   - Keep tests PASSING during REFACTOR

2. **Reference Pattern**:
   - Follow EnhancedTutorialProductCard.js exactly
   - Lines 331-427 contain complete Speed Dial pattern
   - Copy-paste with modifications is acceptable

3. **Git Commits**:
   - Commit after RED phase complete
   - Commit after each GREEN task
   - Commit after REFACTOR phase complete
   - Commit after VALIDATION complete

4. **Testing Commands**:
   ```bash
   # Run specific test file
   npm test TutorialProductCard

   # Run with coverage
   npm test TutorialProductCard -- --coverage --watchAll=false

   # Run all tests
   npm test
   ```

5. **If Tests Fail**:
   - Don't proceed to next phase
   - Debug failing test
   - Fix implementation or test
   - Verify fix doesn't break other tests

---

## Validation Checklist
*GATE: Verify before marking complete*

- [x] All test scenarios from plan.md covered
- [x] TDD phases complete (RED → GREEN → REFACTOR)
- [x] All tests come before implementation
- [x] Each task specifies exact file path
- [x] No parallel tasks (single file modification)
- [x] Dependencies clearly documented
- [x] Time estimates provided
- [x] Success criteria defined

---

**Status**: ✅ Ready for execution
**Next Action**: Begin with T001 - Create test file structure

*Generated from plan.md following TDD principles and CLAUDE.md constitution*
